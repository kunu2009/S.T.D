<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin the Bottle - Party Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .setup-screen {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .player-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        input {
            padding: 12px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            text-align: center;
            outline: none;
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .players-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .player-tag {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            position: relative;
        }

        .remove-player {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            margin-left: 8px;
            cursor: pointer;
            padding: 0;
        }

        .game-area {
            display: none;
            position: relative;
        }

        .players-circle {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto 30px;
            border: 3px dashed rgba(255,255,255,0.3);
            border-radius: 50%;
        }

        .player-position {
            position: absolute;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .player-position.selected {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border-color: #fff;
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .bottle-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
        }

        .bottle {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #8B4513, #A0522D);
            border-radius: 10px 10px 50% 50%;
            position: relative;
            transition: transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }

        .bottle::after {
            content: '';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 50px;
            background: linear-gradient(45deg, #654321, #8B4513);
            border-radius: 10px 10px 0 0;
        }

        .spinning {
            animation: spin 3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(var(--rotation)); }
        }

        .game-controls {
            margin: 20px 0;
        }

        .mode-selection {
            display: none;
            margin: 20px 0;
        }

        .mode-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            font-size: 18px;
            padding: 15px 30px;
        }

        .content-card {
            display: none;
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .content-card p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .situation-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .situation-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .situation-option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .timer {
            display: none;
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            margin: 15px 0;
        }

        .custom-content {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .custom-input {
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
        }

        textarea.custom-input {
            min-height: 100px;
            resize: vertical;
        }

        .tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: rgba(255,255,255,0.4);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .players-circle {
                width: 300px;
                height: 300px;
            }
            
            .bottle-container {
                width: 80px;
                height: 80px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .mode-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .player-input {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçæ Spin the Bottle üéâ</h1>
        
        <!-- Setup Screen -->
        <div id="setupScreen" class="setup-screen">
            <h2>Add Players (3-10)</h2>
            <div class="player-input">
                <input type="text" id="playerName" placeholder="Enter player name" maxlength="20">
                <button onclick="addPlayer()">Add Player</button>
            </div>
            
            <div class="players-list" id="playersList"></div>
            
            <button onclick="startGame()" id="startGameBtn" style="display: none;">Start Game</button>
            
            <!-- Custom Content Management -->
            <div class="custom-content">
                <h3>Manage Custom Content</h3>
                <div class="tabs">
                    <button class="tab active" onclick="showTab('truths')">Truths</button>
                    <button class="tab" onclick="showTab('dares')">Dares</button>
                    <button class="tab" onclick="showTab('situations')">Situations</button>
                </div>
                
                <div id="truthsTab">
                    <textarea class="custom-input" id="customTruth" placeholder="Enter a custom truth question..."></textarea>
                    <button onclick="addCustomContent('truths')">Add Truth</button>
                </div>
                
                <div id="daresTab" class="hidden">
                    <textarea class="custom-input" id="customDare" placeholder="Enter a custom dare..."></textarea>
                    <button onclick="addCustomContent('dares')">Add Dare</button>
                </div>
                
                <div id="situationsTab" class="hidden">
                    <textarea class="custom-input" id="customSituation" placeholder="Enter a situation with options separated by | (e.g., 'What would you do? Option 1|Option 2|Option 3')"></textarea>
                    <button onclick="addCustomContent('situations')">Add Situation</button>
                </div>
            </div>
        </div>
        
        <!-- Game Area -->
        <div id="gameArea" class="game-area">
            <div class="players-circle" id="playersCircle">
                <div class="bottle-container">
                    <div class="bottle" id="bottle" onclick="spinBottle()"></div>
                </div>
            </div>
            
            <div class="game-controls">
                <button onclick="spinBottle()" id="spinBtn">Spin the Bottle!</button>
                <button onclick="backToSetup()">Back to Setup</button>
            </div>
            
            <div class="mode-selection" id="modeSelection">
                <h3>Choose a mode for <span id="selectedPlayer"></span>:</h3>
                <div class="mode-buttons">
                    <button class="mode-button" onclick="selectMode('truth')">Truth</button>
                    <button class="mode-button" onclick="selectMode('dare')">Dare</button>
                    <button class="mode-button" onclick="selectMode('situation')">Situation</button>
                </div>
            </div>
            
            <div class="content-card" id="contentCard">
                <h3 id="cardTitle"></h3>
                <p id="cardContent"></p>
                <div class="situation-options" id="situationOptions"></div>
                <div class="timer" id="timer"></div>
                <button onclick="nextRound()">Next Round</button>
                <button onclick="skipRound()">Skip</button>
            </div>
        </div>
    </div>

    <script>
        class SpinTheBottleGame {
            constructor() {
                this.players = [];
                this.currentPlayer = null;
                this.isSpinning = false;
                this.initializeGame();
                this.loadData();
            }

            initializeGame() {
                // Default content
                this.defaultTruths = [
                    "What's the most embarrassing thing that happened to you this year?",
                    "Who was your first crush?",
                    "What's your biggest secret talent?",
                    "If you could date anyone in this room, who would it be?",
                    "What's the weirdest dream you've ever had?",
                    "What's your most used emoji?",
                    "Who in this group would survive the longest in a zombie apocalypse?",
                    "What's the most childish thing you still do?",
                    "What app do you waste the most time on?",
                    "What's your worst habit?"
                ];

                this.defaultDares = [
                    "Do your best impression of someone in the room",
                    "Sing the chorus of your favorite song",
                    "Do 10 push-ups",
                    "Text your crush (or pretend to)",
                    "Do a silly dance for 30 seconds",
                    "Speak in an accent for the next 3 rounds",
                    "Let someone else post on your social media",
                    "Eat a spoonful of a condiment",
                    "Do your best superhero pose and hold it for 30 seconds",
                    "Call someone and sing Happy Birthday to them"
                ];

                this.defaultSituations = [
                    "You find a wallet with $100. What do you do?|Keep the money|Return it to owner|Donate to charity|Give it to a friend",
                    "You're trapped in an elevator with your worst enemy. How do you pass time?|Ignore them completely|Try to make peace|Start an argument|Take a nap",
                    "You can have dinner with any celebrity. Who do you choose?|A famous actor|A world leader|A musician|A scientist",
                    "You win the lottery. What's your first purchase?|A house|A car|A vacation|Help family/friends",
                    "You discover you have a superpower. What would you want it to be?|Flying|Invisibility|Mind reading|Time travel"
                ];

                // Load custom content or use defaults
                this.customTruths = JSON.parse(localStorage.getItem('customTruths') || '[]');
                this.customDares = JSON.parse(localStorage.getItem('customDares') || '[]');
                this.customSituations = JSON.parse(localStorage.getItem('customSituations') || '[]');
            }

            loadData() {
                const savedPlayers = localStorage.getItem('spinBottlePlayers');
                if (savedPlayers) {
                    this.players = JSON.parse(savedPlayers);
                    this.updatePlayersDisplay();
                    if (this.players.length >= 3) {
                        document.getElementById('startGameBtn').style.display = 'block';
                    }
                }
            }

            saveData() {
                localStorage.setItem('spinBottlePlayers', JSON.stringify(this.players));
                localStorage.setItem('customTruths', JSON.stringify(this.customTruths));
                localStorage.setItem('customDares', JSON.stringify(this.customDares));
                localStorage.setItem('customSituations', JSON.stringify(this.customSituations));
            }

            addPlayer() {
                const input = document.getElementById('playerName');
                const name = input.value.trim();
                
                if (name && this.players.length < 10 && !this.players.includes(name)) {
                    this.players.push(name);
                    input.value = '';
                    this.updatePlayersDisplay();
                    this.saveData();
                    
                    if (this.players.length >= 3) {
                        document.getElementById('startGameBtn').style.display = 'block';
                    }
                    
                    this.playSound('pop');
                }
            }

            removePlayer(name) {
                this.players = this.players.filter(player => player !== name);
                this.updatePlayersDisplay();
                this.saveData();
                
                if (this.players.length < 3) {
                    document.getElementById('startGameBtn').style.display = 'none';
                }
            }

            updatePlayersDisplay() {
                const list = document.getElementById('playersList');
                list.innerHTML = this.players.map(name => 
                    `<div class="player-tag">
                        ${name}
                        <button class="remove-player" onclick="game.removePlayer('${name}')">√ó</button>
                    </div>`
                ).join('');
            }

            startGame() {
                if (this.players.length < 3) return;
                
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('gameArea').style.display = 'block';
                this.setupPlayersCircle();
            }

            setupPlayersCircle() {
                const circle = document.getElementById('playersCircle');
                const existingPlayers = circle.querySelectorAll('.player-position');
                existingPlayers.forEach(player => player.remove());
                
                const radius = 180;
                const centerX = 200;
                const centerY = 200;
                
                this.players.forEach((player, index) => {
                    const angle = (index * (360 / this.players.length)) * (Math.PI / 180);
                    const x = centerX + radius * Math.cos(angle - Math.PI / 2);
                    const y = centerY + radius * Math.sin(angle - Math.PI / 2);
                    
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player-position';
                    playerDiv.textContent = player;
                    playerDiv.style.left = x + 'px';
                    playerDiv.style.top = y + 'px';
                    playerDiv.dataset.index = index;
                    
                    circle.appendChild(playerDiv);
                });
            }

            spinBottle() {
                if (this.isSpinning) return;
                
                this.isSpinning = true;
                const bottle = document.getElementById('bottle');
                const spinBtn = document.getElementById('spinBtn');
                const modeSelection = document.getElementById('modeSelection');
                const contentCard = document.getElementById('contentCard');
                
                spinBtn.disabled = true;
                modeSelection.style.display = 'none';
                contentCard.style.display = 'none';
                
                // Clear previous selection
                document.querySelectorAll('.player-position').forEach(p => p.classList.remove('selected'));
                
                // Random rotation (multiple full rotations + random angle)
                const randomRotation = 720 + Math.random() * 1080; // 2-5 full rotations
                bottle.style.setProperty('--rotation', randomRotation + 'deg');
                bottle.classList.add('spinning');
                
                this.playSound('spin');
                
                setTimeout(() => {
                    // Calculate which player the bottle points to
                    const normalizedAngle = (randomRotation + 90) % 360; // Adjust for bottle tip
                    const playerIndex = Math.floor((normalizedAngle / 360) * this.players.length);
                    const selectedIndex = (this.players.length - playerIndex - 1) % this.players.length; // Reverse direction
                    
                    this.currentPlayer = this.players[selectedIndex];
                    
                    // Highlight selected player
                    const playerElements = document.querySelectorAll('.player-position');
                    playerElements[selectedIndex].classList.add('selected');
                    
                    // Show mode selection
                    document.getElementById('selectedPlayer').textContent = this.currentPlayer;
                    modeSelection.style.display = 'block';
                    
                    bottle.classList.remove('spinning');
                    spinBtn.disabled = false;
                    this.isSpinning = false;
                    
                    this.playSound('ding');
                }, 3000);
            }

            selectMode(mode) {
                const modeSelection = document.getElementById('modeSelection');
                const contentCard = document.getElementById('contentCard');
                const cardTitle = document.getElementById('cardTitle');
                const cardContent = document.getElementById('cardContent');
                const situationOptions = document.getElementById('situationOptions');
                const timer = document.getElementById('timer');
                
                modeSelection.style.display = 'none';
                contentCard.style.display = 'block';
                situationOptions.style.display = 'none';
                timer.style.display = 'none';
                
                switch(mode) {
                    case 'truth':
                        this.showTruth(cardTitle, cardContent);
                        break;
                    case 'dare':
                        this.showDare(cardTitle, cardContent, timer);
                        break;
                    case 'situation':
                        this.showSituation(cardTitle, cardContent, situationOptions);
                        break;
                }
                
                this.playSound('card');
            }

            showTruth(titleElement, contentElement) {
                const allTruths = [...this.defaultTruths, ...this.customTruths];
                const randomTruth = allTruths[Math.floor(Math.random() * allTruths.length)];
                
                titleElement.textContent = `Truth for ${this.currentPlayer}`;
                contentElement.textContent = randomTruth;
            }

            showDare(titleElement, contentElement, timerElement) {
                const allDares = [...this.defaultDares, ...this.customDares];
                const randomDare = allDares[Math.floor(Math.random() * allDares.length)];
                
                titleElement.textContent = `Dare for ${this.currentPlayer}`;
                contentElement.textContent = randomDare;
                
                // Start 60-second timer
                timerElement.style.display = 'block';
                this.startTimer(60, timerElement);
            }

            showSituation(titleElement, contentElement, optionsElement) {
                const allSituations = [...this.defaultSituations, ...this.customSituations];
                const randomSituation = allSituations[Math.floor(Math.random() * allSituations.length)];
                const [scenario, ...options] = randomSituation.split('|');
                
                titleElement.textContent = `Situation for ${this.currentPlayer}`;
                contentElement.textContent = scenario;
                
                optionsElement.style.display = 'block';
                optionsElement.innerHTML = options.map((option, index) => 
                    `<div class="situation-option" onclick="game.selectSituationOption(${index}, '${option}')">${option}</div>`
                ).join('');
            }

            selectSituationOption(index, option) {
                const responses = [
                    "Interesting choice! You're quite practical.",
                    "Bold move! You're definitely a risk-taker.",
                    "Classic response! You play it safe.",
                    "Unexpected! You think outside the box.",
                    "Smart choice! You're a strategic thinker."
                ];
                
                const cardContent = document.getElementById('cardContent');
                cardContent.innerHTML += `<br><br><strong>You chose:</strong> ${option}<br><em>${responses[Math.floor(Math.random() * responses.length)]}</em>`;
                
                // Disable other options
                document.querySelectorAll('.situation-option').forEach(opt => {
                    opt.style.pointerEvents = 'none';
                    opt.style.opacity = '0.6';
                });
            }

            startTimer(seconds, element) {
                let timeLeft = seconds;
                const updateTimer = () => {
                    element.textContent = `‚è∞ ${timeLeft}s`;
                    if (timeLeft > 0) {
                        timeLeft--;
                        setTimeout(updateTimer, 1000);
                    } else {
                        element.textContent = "‚è∞ Time's up!";
                        this.playSound('timeup');
                    }
                };
                updateTimer();
            }

            nextRound() {
                document.getElementById('modeSelection').style.display = 'none';
                document.getElementById('contentCard').style.display = 'none';
                document.querySelectorAll('.player-position').forEach(p => p.classList.remove('selected'));
                this.currentPlayer = null;
            }

            skipRound() {
                this.nextRound();
            }

            backToSetup() {
                document.getElementById('gameArea').style.display = 'none';
                document.getElementById('setupScreen').style.display = 'block';
                this.nextRound();
            }

            addCustomContent(type) {
                const content = document.getElementById(`custom${type.charAt(0).toUpperCase() + type.slice(0, -1)}`).value.trim();
                if (!content) return;
                
                switch(type) {
                    case 'truths':
                        this.customTruths.push(content);
                        break;
                    case 'dares':
                        this.customDares.push(content);
                        break;
                    case 'situations':
                        this.customSituations.push(content);
                        break;
                }
                
                document.getElementById(`custom${type.charAt(0).toUpperCase() + type.slice(0, -1)}`).value = '';
                this.saveData();
                this.playSound('success');
                
                // Show success message
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Added!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 1000);
            }

            showTab(tabName) {
                // Hide all tabs
                document.querySelectorAll('[id$="Tab"]').forEach(tab => tab.classList.add('hidden'));
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                
                // Show selected tab
                document.getElementById(tabName + 'Tab').classList.remove('hidden');
                event.target.classList.add('active');
            }

            playSound(type) {
                // Simple Web Audio API sounds
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                const sounds = {
                    pop: { frequency: 800, duration: 0.1 },
                    spin: { frequency: 200, duration: 0.3 },
                    ding: { frequency: 1000, duration: 0.2 },
                    card: { frequency: 600, duration: 0.15 },
                    success: { frequency: 1200, duration: 0.2 },
                    timeup: { frequency: 300, duration: 0.5 }
                };
                
                if (sounds[type]) {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = sounds[type].frequency;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + sounds[type].duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + sounds[type].duration);
                }
            }
        }

        // Global functions for HTML onclick events
        let game;

        function addPlayer() {
            game.addPlayer();
        }

        function startGame() {
            game.startGame();
        }

        function spinBottle() {
            game.spinBottle();
        }

        function selectMode(mode) {
            game.selectMode(mode);
        }

        function nextRound() {
            game.nextRound();
        }

        function skipRound() {
            game.skipRound();
        }

        function backToSetup() {
            game.backToSetup();
        }

        function addCustomContent(type) {
            game.addCustomContent(type);
        }

        function showTab(tabName) {
            game.showTab(tabName);
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            game = new SpinTheBottleGame();
            
            // Allow adding players with Enter key
            document.getElementById('playerName').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addPlayer();
                }
            });
        });

        // Register service worker for offline capability
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'spin-bottle-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('SW registered'))
                    .catch(() => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>s